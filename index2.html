<!DOCTYPE html>
<html>

<head>
    <script src="jquery-3.3.1.min.js"></script>
    <script src="textcomp.js"></script>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
        crossorigin="anonymous">
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
        crossorigin="anonymous"></script>
    <script src="./wikidata-sdk.js"></script>
    <script src="./js-md5.js"></script>
    <link rel="stylesheet" href="main.css">
</head>

<body>
    <div class="container">
        <textarea id="textarea" cols="100" rows="20"></textarea>
        <div id="idMyModal"></div>
    </div>
    

</body>

<script>
    var words = [];
    var data = {};
    $('textarea').textcomplete([{
        match: /(^|\b)(\w{2,})$/,
        search: function (term, callback) {
            data = searchTextOnWikidata(term);
            data.search.forEach(element => {
                words.push(element.label);
            });
            words.sort();
            callback($.map(words, function (word) {
                return word;
            }));
        },
        replace: function (word) {
            return word + ' ';
        }
    }], {
        maxCount: 20,
        onKeydown: function (e, commands) {
            if (e.keyCode === 39) {
                var activeLi = $("ul[id*=textcomplete-dropdown-1] li.active");
                var activeIndex = activeLi.index();

                activeLi.css('display: block; padding-left: 0px;');
                activeLi.addClass('in');


                imageQ = "https://www.wikidata.org/w/api.php?action=wbgetclaims&entity=" + data.search[
                        activeIndex].title +
                    "&property=P18&format=json"

                var imgText = searchQuery(imageQ).claims.P18[0].mainsnak.datavalue.value.split(' ').join(
                    '_');
                var hash = md5(imgText);
                var a = hash.substring(0, 1);
                var b = hash.substring(1, 2);

                imageText = "https://upload.wikimedia.org/wikipedia/commons/" + a + "/" + a + b +
                    "/Aa_rand_2008_3.jpg"

                var header = "This is my dynamic header";
                var content = "This is my dynamic content";
                var strSubmitFunc = "applyButtonFunc()";
                var btnText = "Just do it!";
                doModal('idMyModal', header, content, strSubmitFunc, btnText);

                return true;
            }
        }
    });

    function searchTextOnWikidata(text) {
        const Http = new XMLHttpRequest();
        const url = wdk.searchEntities(text, 'en', 20, 'json');
        Http.open("GET", url, false);
        Http.send();

        if (Http.readyState == 4 && Http.status == 200) {
            var response = JSON.parse(Http.response);
            return response;
        }
    }

    function searchQuery(imgQuey) {
        const Http = new XMLHttpRequest();
        const url = imgQuey
        Http.open("GET", url, false);
        Http.send();
        if (Http.readyState == 4 && Http.status == 200) {
            var response = JSON.parse(Http.response);
            return response;
        }
    }
</script>


<script title="mondal methods">
    function doModal(placementId, heading, formContent, strSubmitFunc, btnText) {
        var html = '<div id="modalWindow" class="modal hide fade in" style="display:none;">';
        html += '<div class="modal-header">';
        html += '<a class="close" data-dismiss="modal">Ã—</a>';
        html += '<h4>' + heading + '</h4>'
        html += '</div>';
        html += '<div class="modal-body">';
        html += '<p>';
        html += formContent;
        html += '</div>';
        html += '<div class="modal-footer">';
        if (btnText != '') {
            html += '<span class="btn btn-success"';
            html += ' onClick="' + strSubmitFunc + '">' + btnText;
            html += '</span>';
        }
        html += '<span class="btn" data-dismiss="modal">';
        html += 'Close';
        html += '</span>'; // close button
        html += '</div>'; // footer
        html += '</div>'; // modalWindow
        $("#" + placementId).html(html);
        $("#modalWindow").modal();
    }


    function hideModal() {
        // Using a very general selector - this is because $('#modalDiv').hide
        // will remove the modal window but not the mask
        $('.modal.in').modal('hide');
    }
</script>

</html>